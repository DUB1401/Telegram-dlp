# Telegram-dlp
**Telegram-dlp** – это бот Telegram для скачивания видеороликов из сети, поддерживающий распознание водяных знаков, извлечение аудиодорожек и буферизацию контента для мгновенной повторной отправки. Также в систему внедрена удобная панель управления, позволяющая ознакомится со статистикой или проводить рассылку сообщений подписчикам бота.

Бот оптимизирован для работы со следующими источниками:
* [ВКонтакте](https://vk.com/)
* [YouTube](https://www.youtube.com/)
* [TikTok](https://www.tiktok.com//)
* [Instagram](https://www.instagram.com/)

Со списком остальных сайтов, работа с которыми также теоретически поддерживается, но не горонтируется, можно ознакомится [здесь](https://github.com/yt-dlp/yt-dlp).

Для вывода дополнительных режимов загрузки выполните команду `/settings`.

## Порядок установки и использования
1. Скачать и распаковать последний релиз.
2. Убедиться в доступности на вашем устройстве Python версии 3.12 или новее.
3. Открыть каталог со скриптом в консоли: можно воспользоваться командой `cd` или встроенными возможностями файлового менеджера.
4. Создать виртуальное окружение Python.
```
python -m venv .venv
```
5. Активировать вирутальное окружение. 
```Shell
# Для Windows.
.venv\Scripts\activate.bat

# Для Linux или MacOS.
source .venv/bin/activate
```
6. Установить зависимости.
```
pip install -r requirements.txt
```
7. Произвести настройку путём редактирования файла _Settings.json_.
8. В вирутальном окружении выполнить команду с подстановкой аргументов: `main.py login {PHONE_NUMBER} {API_ID} {API_HASH}` и следовать дальнейшим инструкциям.
9. При намерении загружать ролики из Instagram необходимо получить из браузера с произведённой авторизацией в сервисе файл куков в формате Netscape и поместить его в этот [каталог](yt-dlp) под именем _instagram.cookies_. 
10. После подключения аккаунта запустить файл `main.py`. 
11. Для автоматического запуска рекомендуется провести инициализацию сервиса через [systemd](systemd/README.md) на Linux или путём добавления его в автозагрузку на Windows.

# Settings.json
```JSON
"token": ""
```
Сюда необходимо занести токен бота Telegram (можно получить у [BotFather](https://t.me/BotFather)).
___
```JSON
"bot_name": ""
```
Сюда необходимо занести строковый идентификатор бота (можно получить из ссылки на бота, например: `https://t.me/bot_name`).
___
```JSON
"trusted_sources_id": []
```
Сюда необходимо занести ID пользователей Telegram, от имени которых выполняется загрузка файлов на сервер (можно узнать у [Chat ID Bot](https://t.me/chat_id_echo_bot)).
___
```JSON
"password": "1234"
```
Указывает пароль для доступа в панель управления.
___
```JSON
"premium": false
```
Здесь указывается, имеется ли у хозяина бота Premium-подписка. Влияет на максимальный размер загружаемого файла. Определяется автоматически.
___
```JSON
"quality_improvement": false
```
Включает постобработку для улучшения качества видео. На данный момент не оказывает влияния на загружаемый ролик.
___
```JSON
"proxy": ""
```
Здесь указывается прокси для обхода региональных ограничений в формате `http://login:password@host:port`.
___
```JSON
"venv": true
```
Указывает внутренним вызовам, что скрипт выполняется в виртуальном окружении.
___
```JSON
"modules": {}
```
Здесь можно указывать дополнительные настройки, специфичные для обработчиков конкретных сайтов.

## Дополнительные параметры обработчиков

### instagram
| **Ключ**          | **Тип** | **Описание**                                                                       |
|-------------------|---------|------------------------------------------------------------------------------------|
| cookies_generator | string  | Указывает Shell-команду для запуска скрипта, обновляющего cookies для авторизации. |

# Благодарность
* [@yt-dlp](https://github.com/yt-dlp) – библиотека загрузки потокового видео.

_Copyright © DUB1401. 2024._